rule:
  meta:
    name: check for AV emulation using VirtualAllocExNuma
    namespace: anti-analysis/anti-av
    authors:
      - jakub.jozwiak@mandiant.com
    scope: basic block
    mbc:
      - Anti-Behavioral Analysis::Emulator Evasion [B0005]
    references:
      - https://www.purpl3f0xsecur1ty.tech/2021/03/30/av_evasion.html
    examples:
      - 17b31898c3613d6e86d06260c7e6f7738d3afdf0f0a4010e2f5259c502d38b09:0x10001A1D
  features:
    - and:
      - api: kernel32.VirtualAllocExNuma
      - api: kernel32.GetCurrentProcess
