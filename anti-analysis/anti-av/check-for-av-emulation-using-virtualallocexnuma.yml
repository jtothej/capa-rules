rule:
  meta:
    name: check for AV emulation using VirtualAllocExNuma
    namespace: anti-analysis/anti-av
    authors:
      - jakub.jozwiak@mandiant.com
    scope: basic block
    mbc:
      - Anti-Behavioral Analysis::Emulator Evasion [B0005]
    references:
      - https://www.purpl3f0xsecur1ty.tech/2021/03/30/av_evasion.html
    examples:
      - 23604a06b0720a430f8d6f6b14b589d850e4cfd291a47f22f199324f21169c1a:0x10084520
  features:
    - and:
      - api: kernel32.VirtualAllocExNuma
      - api: kernel32.GetCurrentProcess
